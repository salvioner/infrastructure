var isModule="undefined"!=typeof module&&module.exports;isModule&&(http=require("http"),URL=require("url"));var Weather={Utils:{}};Weather.VERSION="0.0.3";var jsonp=Weather.Utils.jsonp=function(t,e){return new Promise(function(e,n){var r="_"+Math.round(1e4*Math.random()),a="jsonp_callback_"+r,i=document.getElementsByTagName("head")[0]||document.body||document.documentElement,o=document.createElement("script"),u=t+"&callback="+a;window[a]=function(t){delete window[a];var n=document.getElementById(r);n.parentNode.removeChild(n),e(t)},o.src=u,o.id=r,o.addEventListener("error",n),i.appendChild(o)})};Weather.kelvinToFahrenheit=function(t){return 1.8*this.kelvinToCelsius(t)+32},Weather.kelvinToCelsius=function(t){return t-273.15},Weather.getCurrent=function(t,e){var n="http://openweathermap.org/data/2.1/find/city?q="+encodeURIComponent(t)+"&cnt=1";return this._getJSON(n,function(t){e(new Weather.Current(t))})},Weather.getForecast=function(t,e){var n="http://openweathermap.org/data/2.1/forecast/city?q="+encodeURIComponent(t)+"&cnt=1";return this._getJSON(n,function(t){e(new Weather.Forecast(t))})},Weather._getJSON=function(t,e){return isModule?http.get(URL.parse(t),function(t){return e(t.body)}):void jsonp(t).then(e)};var maxBy=Weather.Utils.maxBy=function(t,e){var n,r=function(t,r){var a=e(r);return(null===t||a>n)&&(n=a,t=r),t};return t.reduce(r,null)},minBy=Weather.Utils.minBy=function(t,e){var n,r=function(t,r){var a=e(r);return(null===t||n>a)&&(n=a,t=r),t};return t.reduce(r,null)},isOnDate=Weather.Utils.isOnDate=function(t,e){var n=t.getYear()===e.getYear(),r=t.getMonth()===e.getMonth(),a=t.getDate()===e.getDate();return n&&r&&a};Weather.Forecast=function(t){this.data=t},Weather.Forecast.prototype.startAt=function(){return new Date(1e3*minBy(this.data.list,function(t){return t.dt}).dt)},Weather.Forecast.prototype.endAt=function(){return new Date(1e3*maxBy(this.data.list,function(t){return t.dt}).dt)},Weather.Forecast.prototype.day=function(t){return new Weather.Forecast(this._filter(t))},Weather.Forecast.prototype.low=function(){if(0!==this.data.list.length){var t=minBy(this.data.list,function(t){return t.main.temp_min});return t.main.temp_min}},Weather.Forecast.prototype.high=function(){if(0!==this.data.list.length){var t=maxBy(this.data.list,function(t){return t.main.temp_max});return t.main.temp_max}},Weather.Forecast.prototype._filter=function(t){return{list:this.data.list.filter(function(e){var n=1e3*e.dt;return isOnDate(new Date(n),t)?e:void 0})}},Weather.Current=function(t){this.data=t},Weather.Current.prototype.temperature=function(){return this.data.list[0].main.temp},Weather.Current.prototype.conditions=function(){return this.data.list[0].weather[0].description},isModule?module.exports=Weather:window.Weather=Weather;